

<!DOCTYPE html>
<html>
<head>
    <title>{% block title %}{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    {% block stylesheets %}{% endblock %}
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>


</head>
<body>
    <header>
        <div class="header-content">
            
            <div class="hamburger" onclick="toggleSidebar()">
                &#9776; <!-- Unicode character for hamburger icon -->
            </div>
            <h1>{% block header %}{% endblock %}</h1>
        </div>
        <div id="user-info" style="position: absolute; right: 20px; top: 20px;">
          {% if user %}
              <!-- Profile Picture with onClick event to toggle dropdown -->
              <img src="{{ user.profile_pic_url | default('path/to/default/profile/pic.png') }}" alt="{{ user.username }}" width="50" height="50" onclick="toggleDropdown()">
              <span>{{ user.username }}</span>
              <!-- Dropdown Menu -->
              <div id="profile-dropdown" class="dropdown-content" style="display:none; position:absolute; right:0; background-color:#f9f9f9; min-width:160px; box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2); z-index:1;">
                  <form action="/delete-account" method="post" onsubmit="return confirm('Are you sure you want to delete your account? This cannot be undone.');">
                      <button type="submit" class="dropdown-item">Delete Account</button>
                  </form>
                  <!-- Logout Button -->
                  <a href="{{ url_for('logout') }}" class="dropdown-item">Logout</a>
              </div>
          {% else %}
              <!-- Signup/Login Button -->
              <a href="{{ url_for('login') }}" class="btn-login">Signup/Login</a>
          {% endif %}
      </div>
        <hr>
        
    </header>
    
    <aside class="sidebar">
        <!-- Sidebar content -->
        <ul>
            <li class="{% if request.endpoint == 'dashboard' %}active{% endif %}"><a href="{{ url_for('dashboard') }}">Home</a></li>
            <hr>
            <li class="courses-heading">Courses</li>
            {% for course in courses %}
                <li><a href="{{ url_for('course_details', course_id=course.id) }}">{{ course['name'] }}</a></li>
            {% endfor %}
        </ul>
    </aside>
    <div id="signupModal" class="modal">
      <!-- Modal content -->
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Sign Up for Free!</h2>
        <form action="/signup" method="post">
          <label for="username">Username:</label>
          <input type="text" id="username" name="username" required>
    
          <label for="password">Password:</label>
          <input type="password" id="password" name="password" required>
    
          <input type="submit" value="Sign Up">
        </form>
        <p>Already have an account? <a href="/login">Log in here</a>.</p>
      </div>
    </div>
    <main class="content">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                {% if message != 'signup_prompt' %}
                    <div class="flash-message flash-{{ category }}">
                        {{ message }}
                    </div>
                {% endif %}
            {% endfor %}
        {% endif %}
        {% endwith %}
        {% block content %}{% endblock %}
    </main>
 
    <script>
        function toggleSidebar() {
    var sidebar = document.querySelector('.sidebar');
    var content = document.querySelector('.content');
    sidebar.classList.toggle('visible');
    content.classList.toggle('content-shift');
}
    </script>
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        {% if message == 'signup_prompt' %}
          <script type="text/javascript">
            // JavaScript to open the signup modal
            window.onload = function() {
              // Code to trigger the modal popup
              var signupModal = document.getElementById('signupModal');
              signupModal.style.display = 'block';
            }
          </script>
        {% endif %}
      
      {% endfor %}
    {% endif %}
  {% endwith %}

<script>
  
  // When the user clicks on <span> (x), close the modal
  var span = document.getElementsByClassName("close")[0];
  span.onclick = function() {
    var modal = document.getElementById('signupModal');
    modal.style.display = "none";
  }

  // When the user clicks anywhere outside of the modal, close it
  window.onclick = function(event) {
    var modal = document.getElementById('signupModal');
    if (event.target == modal) {
      modal.style.display = "none";
    }
  }
   // Function to toggle the dropdown visibility
   function toggleDropdown() {
      var dropdown = document.getElementById("profile-dropdown");
      dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
  }

  // Event listener to close the dropdown if clicked outside of it
  window.onclick = function(event) {
      if (!event.target.matches('img[alt="{{ user.username }}"]')) {
          var dropdowns = document.getElementsByClassName("dropdown-content");
          for (var i = 0; i < dropdowns.length; i++) {
              var openDropdown = dropdowns[i];
              if (openDropdown.style.display === 'block') {
                  openDropdown.style.display = 'none';
              }
          }
      }
  }

      
function toggleManualUpdate() {
    var autoUpdateCheckbox = document.getElementById('autoupdate-mark');
    var manualUpdateButton = document.getElementById('update-mark-manually');
    if (autoUpdateCheckbox && manualUpdateButton) {
        manualUpdateButton.style.display = autoUpdateCheckbox.checked ? 'none' : 'block';
    }

    }
toggleManualUpdate();

function toggleAutoupdate(checkbox) {
toggleManualUpdate();
  const checked = checkbox.checked;
  document.getElementById('autoupdate-status').textContent = checked ? '' : 'Off';


  // Save the preference locally
  localStorage.setItem('autoupdate', checked);

  // Send the state to the server
  fetch('/set-autoupdate-preference', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ autoupdate: checked })
  })
  .then(response => response.json())
  .then(data => {
    console.log(data.message); // Handle any response from the server here
  })
  .catch(error => console.error('Error:', error));
}
 
      

</script>
</body>
</html>
