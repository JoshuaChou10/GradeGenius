<!-- course_details.html -->
{% extends 'base.html' %}



{% block stylesheets %}
    <!-- Specific stylesheet for the course details page -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/course_details.css') }}">
{% endblock %}
{% block header %}{{ course.name }} - {{course.grade |round(2)}}%{% endblock %}

<button onclick="show()">Update Mark Manually</button>
{% block content %}

    <!-- Notification Bar -->
    {% if time_left == 0 %}
    <div class="flash-message flash-warning">
        Course is finished!
    </div>
    {% endif %}

   
    <div id="update_grade" class="modal">
        <!-- Modal content -->
        <div class="modal-content">
            <span class="close">&times;</span>
            <form action="{{ url_for('update_grade', course_id=course.id) }}" method="post">
                <label for="new_grade">Enter Updated Grade:</label>
                <input type="text" id="new_grade" name="new_grade" required>
                <input type="submit" value="Update Grade">
            </form>
        </div>
    </div>
    <main>
        <button onclick="show()">Update Mark Manually</button>
        <section class="course-details">
            <div class="section-header">
                <h2>Course Information</h2>
              
              
            </div>
            <a href="{{ url_for('edit_course', course_id=course.id) }}" class="add-btn">Edit Course</a>
            <div class="info-grid">
              
                <div class="info-item">
                    <label>Code</label>
                    <p>{{ course.code }}</p>
                </div>
                <div class="info-item">
                    <label>Description</label>
                    <p>{{ course.description }}</p>
                </div>
                <div class="info-item">
                    <label>Days left</label>
                    <p>{{ time_left }}</p>
                </div>
                <div class="info-item">
                    <label>End Date</label>
                    <p>{{course.end_date.strftime('%B %d, %Y') }}</p>
                </div>
            </div>

            <!-- Assessments Table -->
            <h3>Assessments</h3>
            <a href="{{ url_for('add_assessment', course_id=course.id) }}" class="add-btn">+ Add Assessment</a>
            <p><strong>Starting Score:</strong> {{ (course.starting_marks * course.starting_grade) / 100 }} / {{ course.starting_marks }}</p>
    
            {% if course.assessments|length > 0 %}
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Mark</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for assessment in course.assessments %}
                    <tr>
                        <td>{{ assessment.name }}
                            <form action="{{ url_for('delete_assessment', course_id=course['id'],assessment_id=assessment['id']) }}" method="post" onsubmit="return confirm('Are you sure you want to delete this assessment?');">
                                <input type="hidden" name="_method" value="DELETE">
                                <input type="submit" value="Delete">
                            </form>
                            <form action="{{ url_for('edit_assessment', course_id=course['id'],assessment_id=assessment['id']) }}" method="get">
                                <input type="submit" value="Edit">
                            </form>
                        </td>
                        <td>{{ assessment.earned }} / {{ assessment.total }}</td>
                        <td>{{ assessment.date.strftime('%B %d, %Y') }}</td>
                    </tr>
                    {% endfor %}
             
                    <tr class="total-row">
                        <td>Total</td>
                        <td>{{ (course.total_marks * course.grade) / 100 }} / {{ course.total_marks }}</td>
                        <td></td>  <!-- Empty cell in the Date column -->
                    </tr>
                </tbody>
            </table>
            {% else %}
            <p>No assessments yet!</p>
            {% endif %}
        </section>
    </main>

    <script type="text/javascript">
        // JavaScript to open the signup modal
         function show() {
          // Code to trigger the modal popup
          var update_grade = document.getElementById('update_grade');
          update_grade.style.display = 'block';
        }
          // When the user clicks on <span> (x), close the modal
            document.querySelector(".close").addEventListener("click", function() {
    document.getElementById('update_grade').style.display = "none";
});
// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  var modal = document.getElementById('update_grade');
  if (event.target == modal) {
    modal.style.display = "none";
  }
}
      </script>

{% endblock %}
